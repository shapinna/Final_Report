---
title: "Final report"
author: "Shanmukh"
date: "April 22, 2019"
output:
  html_document:
    toc: TRUE
    toc_float: false
    toc_depth: 5
    df_print: paged
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


**Install libraries**
```{r,message=FALSE, warning=FALSE}
library(readr) # to load the files
library(dplyr) # for data wrangling
library(stringr)# for string manipulation
library(zoo) # for filling missing values
library(corrplot)  # to access correlation functions
library(ggplot2) # for plotting
library(car) # heteroscedasticit test
library(tidyverse)  # data manipulation
library(cluster)    # clustering algorithms
library(factoextra) # clustering algorithms & visualization

```






**Gapminder dataset**

- Load gapminder data and assign to gap_d

```{r}
gap_d <- read.csv("C:/Main/Shanmukh/MS/Indiana university/applied data science/Final project/gapminder.csv", header=TRUE)

gap<-gap_d # New data frame gap is created

```



## About gapminder dataset

```{r}
str(gap) # structure of gap data set

summary(gap) # summary of gap dataset
```



* 41284 observations with 6 columns
* Data set is covering 197 countries across 6 regions
* On an average there are 216 records for each country across multiple years
* Data is from year 1800 to 2015
* Country, region and population are with data type factor
* Year & income are with data type integer
* life is a numeric data type
* Income has 2341 null values
* America region has 7961 records and South Asia has 1728 records in the gapminder dataset


## Questions

* Which region is better in Life and Income before 1950 & after 1950?
* Whether life expectancy increases based on Income?
* Whether life expectancy improve over the years?
* Whether Income levels improved over the years?
* Whether population increased where life expectancy is more?



## Data Wrangling

#### Data Transformation

Converting Population data set from factor to Numeric for performing stastical analysis

- replacing comma
```{r}
gap$population <- lapply(gap$population, gsub, pattern = ",", replacement = "", fixed = TRUE)

```


- converting population column from factor to numeric

```{r}

# converting population column from factor to numeric
gap$population <- as.numeric(as.character(gap$population)) 

```

- verify class of population column
```{r}
class(gap$population)

```


#### verify records with null values

- Verify which columns has null values
```{r}
colSums(is.na(gap)) # verify number of null values column wise
```

#### Derive missing population numbers

* As population census is taken once in 10 years same value to be considered for next 9 years

```{r}

# replacing the null population value in the data frame with previous year not null value

gap$population <-na.locf(gap$population, fromLast = FALSE) 

colSums(is.na(gap)) # verify number of null values column wise

```


- verify null value records
```{r, message=FALSE}
 gap_null <-gap %>% 
  filter_all(any_vars(is.na(.))) %>%
  group_by(Country,region)%>%
  summarise(count_na=sum(is.na(income)))

#gap_null

#sum(gap_null$count_na)
```


```{r}

gap_m<-gap[is.na(gap$income),]# subset of data with missing income fields


# Data of non missing values for the countries with missing values
 gap %>% 
  filter(Country%in%gap_m$Country)%>%
  group_by(Country,region)%>%
  summarise(count_na=sum(!is.na(income))) %>%
  filter(count_na>0)

```


From the above analysis we can conclude all the countries with missing income data dont have single record with income details except for croatia

* Croatia has values for 196 records and only 20 records has missing income

```{r}

# Analyze the income data for Croatia
#gap[gap$Country=="Croatia",]

```

* Coratia Income data has been collected only from 1820 and prior years is not collected hence it is not logical to populate missing income values of earlier years with mean or median.

- we conclude that missing income values to the extent of 2341 needs to be omitted on need bases based on the analysis.


## Exploratory Data Analysis


#### Box plots and Variance analysis

##### Variance of Life across Regions

```{r}

ggplot(data=gap,mapping=aes(x=region,y=life,fill=region))+
 geom_boxplot(outlier.colour = "red", outlier.shape = 1)+
 # geom_boxplot(varwidth=TRUE)+
 theme_classic()+
 labs(title="Plot of life across regions",x="Region", y = "Life")+
  stat_summary(fun.y=mean, geom="point", shape=23, size=4)+
 theme(legend.position="bottom")+
  scale_x_discrete(labels=c("Europe & Central Asia" = "Europe & C.Asia", "Middle East & North Africa" = "ME & N.Africa",
                              "East Asia & Pacific" = "E Asia & pacific"))
 # scale_x_discrete(limits=c("Europe & Central Asisa","America","Sub-Saharan Africa"))+
   # coord_flip()

#gap[gap$Year>1950,]

```


```{r}
gap %>%
  group_by(region) %>%
  summarize(mean_life=round(mean(life)), median_life=round(median(life)),
            sd_life = round(sd(life)),
            IQR_life = round(IQR(life)),
            mad_life = round(mad(life)))%>%
  arrange(desc(mean_life))
```

* Europe and Central Asia has high mean life of 49
* south asia and Sub-saharan Africa has comparable mean_life of 37 & 38.
* south asia has outliers near life 80 and sub-saharan has outlier at high and low life.


###### Variance of Life across Regions before 1950

```{r}

ggplot(data=gap[gap$Year<1950,],mapping=aes(x=region,y=life,fill=region))+
 geom_boxplot(outlier.colour = "red", outlier.shape = 1)+
 # geom_boxplot(varwidth=TRUE)+
 theme_classic()+
 labs(title="Plot of life across regions before 1950",x="Region", y = "Life")+
  stat_summary(fun.y=mean, geom="point", shape=23, size=4)+
 theme(legend.position="bottom")+
  scale_x_discrete(labels=c("Europe & Central Asia" = "Europe & C.Asia", "Middle East & North Africa" = "ME & N.Africa",
                              "East Asia & Pacific" = "E Asia & pacific"))
 # scale_x_discrete(limits=c("Europe & Central Asisa","America","Sub-Saharan Africa"))+
   # coord_flip()

#gap[gap$Year>1950,]

```

```{r}
gap %>%
  filter(Year<1950) %>%
  group_by(region) %>%
  summarize(mean_life=round(mean(life)), median_life=round(median(life)),
            sd_life = round(sd(life)),
            IQR_life = round(IQR(life)),
            mad_life = round(mad(life)))%>%
  arrange(desc(mean_life))
```


* Before 1950 has large outliers in the data set for all the regions
* Europe & central asia is better with higher mean and median of 39 & 37 in life however, standard deviation is high out of all regions
* South asia was not doing well in life with mean & median of 29 and stand deviation of 5


###### Variance of Life across Regions after 1950

```{r}

ggplot(data=gap[gap$Year>1950,],mapping=aes(x=region,y=life,fill=region))+
 geom_boxplot(outlier.colour = "red", outlier.shape = 1)+
 # geom_boxplot(varwidth=TRUE)+
 theme_classic()+
 labs(title="Plot of life across regions after 1950",x="Region", y = "Life")+
  stat_summary(fun.y=mean, geom="point", shape=23, size=4)+
 theme(legend.position="bottom")+
  scale_x_discrete(labels=c("Europe & Central Asia" = "Europe & C.Asia", "Middle East & North Africa" = "ME & N.Africa",
                              "East Asia & Pacific" = "E Asia & pacific"))
 # scale_x_discrete(limits=c("Europe & Central Asisa","America","Sub-Saharan Africa"))+
   # coord_flip()


```

```{r}
gap %>%
  filter(Year>1950) %>%
  group_by(region) %>%
  summarize(mean_life=round(mean(life)), median_life=round(median(life)),
            sd_life = round(sd(life)),
            IQR_life = round(IQR(life)),
            mad_life = round(mad(life)))%>%
  arrange(desc(mean_life))
```

* Life expectancy almost doubled before 1950 & after 1950 across all the regions
* Europe & central asia is doing better with mean and median life of 71 with lower standard deviation of 6
* South Asia improved more compared to sub-saharan africa
* Sub-Saharan africa is poor performer in life with mean and median of 54 and with standard deviation of 8 compared to other regions.



##### Variance of Income across regions

```{r}

ggplot(data=gap,mapping=aes(x=region,y=income,fill=region))+
 geom_boxplot(outlier.colour = "red", outlier.shape = 1,na.rm = TRUE)+
 theme_classic()+
 scale_y_continuous(trans='log10')+
 labs(title="Box Plot of income per region",x="Region", y = "Income")+
  stat_summary(fun.y=mean, geom="point", shape=23, size=4,na.rm = TRUE)+
  scale_x_discrete(labels=c("Europe & Central Asia" = "Europe & C.Asia", "Middle East & North Africa" = "ME & N.Africa",
                              "East Asia & Pacific" = "E Asia & pacific"))+
    theme(legend.position="bottom")

gap[complete.cases(gap), ] %>%
  group_by(region) %>%
  summarize(mean_income=round(mean(income)), median_income=round(median(income)),
            sd_income = round(sd(income)),
            IQR_income = round(IQR(income)),
            mad_income = round(mad(income)))%>%
  arrange(desc(mean_income))

```


* Except America and Europe & central Asia all regions has high outliers.
* Europe & Central Asia is better perform since middle east median is very low compared to europe & central asia

* Middle East & North Africa has higher mean income of 8064 with higher standard deviation of 20413
* America is in 3rd rank in mean income, however standard deviation is 6151 and IQR of 4184 denotes the data is having less variance from the mean
* huge outlier exists for regions East Asia & pacific, Middle east& North Africa, south asia & sub saharan africa


###### Variance of Income across regions before 1950

```{r}
ggplot(data=gap[gap$Year<1950,],mapping=aes(x=region,y=income,fill=region))+
 geom_boxplot(outlier.colour = "red", outlier.shape = 1,na.rm = TRUE)+
 theme_classic()+
 scale_y_continuous(trans='log10')+
 labs(title="Box Plot of income across regions before 1950",x="Region", y = "Income")+
  stat_summary(fun.y=mean, geom="point", shape=23, size=4,na.rm = TRUE)+
  scale_x_discrete(labels=c("Europe & Central Asia" = "Europe & C.Asia", "Middle East & North Africa" = "ME & N.Africa",
                              "East Asia & Pacific" = "E Asia & pacific"))+
    theme(legend.position="bottom")

gap[complete.cases(gap), ] %>%
  filter(Year<1950) %>%
  group_by(region) %>%
  summarize(mean_income=round(mean(income)), median_income=round(median(income)),
            sd_income = round(sd(income)),
            IQR_income = round(IQR(income)),
            mad_income = round(mad(income)))%>%
  arrange(desc(mean_income))

```

* Before 1950 Income has high outlier across all regions
* Europe & Central Asia is better high mean & median income with high standard deviation
* sub saharan africa is poor peformer in income before 1950 with low mean and median income


###### Variance of Income across regions after 1950

```{r}
ggplot(data=gap[gap$Year>1950,],mapping=aes(x=region,y=income,fill=region))+
 geom_boxplot(outlier.colour = "red", outlier.shape = 1,na.rm = TRUE)+
 theme_classic()+
 scale_y_continuous(trans='log10')+
 labs(title="Box Plot of income across regions after 1950",x="Region", y = "Income")+
  stat_summary(fun.y=mean, geom="point", shape=23, size=4,na.rm = TRUE)+
  scale_x_discrete(labels=c("Europe & Central Asia" = "Europe & C.Asia", "Middle East & North Africa" = "ME & N.Africa",
                              "East Asia & Pacific" = "E Asia & pacific"))+
    theme(legend.position="bottom")

gap[complete.cases(gap), ] %>%
  filter(Year>1950) %>%
  group_by(region) %>%
  summarize(mean_income=round(mean(income)), median_income=round(median(income)),
            sd_income = round(sd(income)),
            IQR_income = round(IQR(income)),
            mad_income = round(mad(income)))%>%
  arrange(desc(mean_income))

```



* After 1950 there are no outliers in income except for sub-sharan africa
* Middle East & North Africa has high mean income however Europe & central Asia is better performer since median income is high with a standadard devation of 13K lower than 32K compared to middle east & north afirca
* sub Asia is poor peformer in income after 1950 with low mean and median income


##### variance of population across regions

```{r}


ggplot(data=gap,mapping=aes(x=region,y=population,fill=region))+
 geom_boxplot(outlier.colour = "red", outlier.shape = 1,na.rm = TRUE)+
 theme_classic()+
 scale_y_continuous(trans='log10')+
 labs(title="Box Plot of Population across regions",x="Region", y = "Population")+
  stat_summary(fun.y=mean, geom="point", shape=23, size=4,na.rm = TRUE)+
  scale_x_discrete(labels=c("Europe & Central Asia" = "Europe & C.Asia", "Middle East & North Africa" = "ME & N.Africa",
                              "East Asia & Pacific" = "E Asia & pacific"))+
    theme(legend.position="bottom")

gap[complete.cases(gap), ] %>%
  group_by(region) %>%
  summarize(mean_population=round(mean(population)), median_population=round(median(population)),
            sd_population = round(sd(population)),
            IQR_population = round(IQR(population)),
            mad_population = round(mad(population)))%>%
  arrange(desc(mean_population))

```


* South Asia and East asia & Pacific has more mean population with higher standard deviation and IQR compared to other regions
* Europe and central Asia has outliers for few countries for few year has lower population
* Sub Saharan Africa has outlier for few records for low and high population


###### Variance of population across regions before 1950

```{r}
ggplot(data=gap[gap$Year<1950,],mapping=aes(x=region,y=population,fill=region))+
 geom_boxplot(outlier.colour = "red", outlier.shape = 1,na.rm = TRUE)+
 theme_classic()+
 scale_y_continuous(trans='log10')+
 labs(title="Box Plot of Population across regions before 1950",x="Region", y = "Population")+
  stat_summary(fun.y=mean, geom="point", shape=23, size=4,na.rm = TRUE)+
  scale_x_discrete(labels=c("Europe & Central Asia" = "Europe & C.Asia", "Middle East & North Africa" = "ME & N.Africa",
                              "East Asia & Pacific" = "E Asia & pacific"))+
    theme(legend.position="bottom")

gap[complete.cases(gap), ] %>%
  filter(Year<1950) %>%
  group_by(region) %>%
  summarize(mean_population=round(mean(population)), median_population=round(median(population)),
            sd_population = round(sd(population)),
            IQR_population = round(IQR(population)),
            mad_population = round(mad(population)))%>%
  arrange(desc(mean_population))

```

* South Asia, Eruope & Central Asis is having more median population compared to other regions
* Middle East & North Africa & sub saharan africa is having low population before 1950 with low mean and median income


###### Variance of Population across regions after 1950

```{r}
ggplot(data=gap[gap$Year>1950,],mapping=aes(x=region,y=population,fill=region))+
 geom_boxplot(outlier.colour = "red", outlier.shape = 1,na.rm = TRUE)+
 theme_classic()+
 scale_y_continuous(trans='log10')+
 labs(title="Box Plot of income across regions after 1950",x="Region", y = "Population")+
  stat_summary(fun.y=mean, geom="point", shape=23, size=4,na.rm = TRUE)+
  scale_x_discrete(labels=c("Europe & Central Asia" = "Europe & C.Asia", "Middle East & North Africa" = "ME & N.Africa",
                              "East Asia & Pacific" = "E Asia & pacific"))+
    theme(legend.position="bottom")

gap[complete.cases(gap), ] %>%
  filter(Year>1950) %>%
  group_by(region) %>%
  summarize(mean_population=round(mean(population)), median_population=round(median(population)),
            sd_population = round(sd(population)),
            IQR_population = round(IQR(population)),
            mad_population = round(mad(population)))%>%
  arrange(desc(mean_population))

```



* After 1950 there are outliers in population only in Europe & Central asia
* South Asia & East Asia & Paific has high mean popuation compared to other regions 
* sub Saharan Africa is having low mean population after 1950 


#### Co-relation between elements of dataset

```{r}
# subset only numeric data type columns without missing values

gap_num <- gap[complete.cases(gap),c(3,4,5)] # removing missing records and only numeric columns

cor(gap_num)

corrplot(cor(gap_num),method="ellipse")

```


* Income and life are having positive relation of 0.57

  - As income increases life expectency increases
  
* Income and population are not having relation of 0.03

  - As the correlation is near 0, there is no relation between Income and population
  
* Life and population are midly positive relation of 0.11

  - As the Population increase Life expectency increases mildly.
  

#### Scatter plot to view Correlation results {.tabset .tabset-fade .tabset-pills}

##### Income Vs Life

```{r}

plot(gap$income~gap$life,pch=19,col="blue",
     main='scatter plot of income vs life',
     xlab="Life",
     ylab='Income')
abline(lm(gap$income~gap$life),col="red",lty=2,lwd=3)

```


* Scatter plot shows that Income and Life are having linear relationship
  - both of them having considerable positive correlation


##### Population Vs Life

```{r}

plot(gap$population~gap$life,pch=19,col="blue",
     main='scatter plot of Population vs life',
     xlab="Life",
     ylab='population')
abline(lm(gap$population~gap$life),col="red",lty=2,lwd=3)

```

* Scatter plot shows Populationa and Life are having linear relationship
  - Both of them having mild positive correlation

##### Income Vs Population

```{r}


plot(gap$income~gap$population,pch=19,col="blue",
     main='scatter plot of Income vs Population',
     xlab="Population",
     ylab='Income')
abline(lm(gap$income~gap$population),col="red",lty=2,lwd=3)


```


* scatter plot shows population and Income are not having any linear relationship
  _ Both of the attributes don't have any relation


#### Trend of Income over life across regions


```{r}
ggplot(gap[complete.cases(gap), ])+
  geom_smooth(mapping=aes(x=life,y=income,col=region))+
  labs(title="Trend of Income over life across regions",x="Life", y = "Income")+
   theme(legend.position="bottom")


```

* Till age of 50 Income don't have any impact over life, from Age of 50 Life expectancy increased with Income levels across all the regions


#### Trend of Population over Life across all regions


```{r}
ggplot(gap[complete.cases(gap), ])+
  geom_smooth(mapping=aes(x=life,y=population,col=region))+
  labs(title="Trend of Population over Life across all regions",x="Life", y = "Population")+
   theme(legend.position="bottom")



```

* Europe & central asia, subsahran africa, Middle East & North Africa, America don't show any trend of popoulation over life

* South Asia has two high points and two low points, indicates distribution is binomial
* East Asia Pacific has data skewed toward right


#### Trend of Population over Income across all regions

```{r}
ggplot(gap[complete.cases(gap), ])+
  geom_smooth(mapping=aes(x=population,y=income,col=region,size=life))+
  labs(title="Trend of Population over Income across regions",x="Life", y = "Income")+
  theme(legend.position="bottom")
```


* Trend of Income over population is not normal across all regions
* Income over population does not show substantial trend across regions


#### Verify Distribution of Life {.tabset .tabset-fade .tabset-pills}

##### All regions

```{r}

hist(gap$life,
     col="grey75",
     main="Distribution of Life",
     #ylim=c(0,0.7),
     prob= TRUE)
curve(dnorm(x,mean(gap$life),
            sd(gap$life)),
      add=TRUE,
      col="red",
      lwd=3)

```

* Life is not normally distributed across all ages
* it is skewed toward right
* No of countries before 40 is high compared to after 40

##### America

```{r}

hist(gap[gap$region=="America",]$life,
     col="grey75",
     main="Distribution of Life for America region",
     prob= TRUE)
curve(dnorm(x,mean(gap[gap$region=="America",]$life),
            sd(gap[gap$region=="America",]$life)),
      add=TRUE,
      col="red",
      lwd=3)
```


* Life for america is not normal it is binomial since theare are two high points


##### East Asia & Pacific

```{r}

hist(gap[gap$region=="East Asia & Pacific",]$life,
     col="grey75",
     main="Distribution of Life for East Asia & Pacific region",
     #ylim=c(0,0.7),
     prob= TRUE)
curve(dnorm(x,mean(gap[gap$region=="East Asia & Pacific",]$life),
            sd(gap[gap$region=="East Asia & Pacific",]$life)),
      add=TRUE,
      col="red",
      lwd=3)

```


* Life for East Asia and pacific is not distributed normally
* Same as america region it has two highs


##### Europe & Central Asia

```{r}
hist(gap[gap$region=="Europe & Central Asia",]$life,
     col="grey75",
     main="Distribution of Life for Europe & Central Asia region",
     #ylim=c(0,0.7),
     prob= TRUE)
curve(dnorm(x,mean(gap[gap$region=="Europe & Central Asia",]$life),
            sd(gap[gap$region=="Europe & Central Asia",]$life)),
      add=TRUE,
      col="red",
      lwd=3)
```

* Life for Europe and central Asia is not distributed normally
* Same as other regions it has two highs

##### Middle East & North Africa

```{r}
hist(gap[gap$region=="Middle East & North Africa",]$life,
     col="grey75",
     main="Distribution of Life for Middle East & North Africa region",
     #ylim=c(0,0.7),
     prob= TRUE)
curve(dnorm(x,mean(gap[gap$region=="Middle East & North Africa",]$life),
            sd(gap[gap$region=="Middle East & North Africa",]$life)),
      add=TRUE,
      col="red",
      lwd=3)
```

* Life for middle east & north africa is not distributed normally
* Same as other regions it has two highs


##### South Asia

```{r}
hist(gap[gap$region=="South Asia",]$life,
     col="grey75",
     main="Distribution of Life for South Asia region",
     #ylim=c(0,0.7),
     prob= TRUE)
curve(dnorm(x,mean(gap[gap$region=="South Asia",]$life),
            sd(gap[gap$region=="South Asia",]$life)),
      add=TRUE,
      col="red",
      lwd=3)
```

* Life for south Asia is not distributed normally
* Data before 40 exceeds normal curve


##### Sub-Saharan Africa
```{r}
hist(gap[gap$region=="Sub-Saharan Africa",]$life,
     col="grey75",
     main="Distribution of Life for Sub-Saharan Africa region",
     #ylim=c(0,0.7),
     prob= TRUE)
curve(dnorm(x,mean(gap[gap$region=="Sub-Saharan Africa",]$life),
            sd(gap[gap$region=="Sub-Saharan Africa",]$life)),
      add=TRUE,
      col="red",
      lwd=3)



```


* Life for sub-saharan africa region is not distributed normally
* data below 30 is outside normal range.



  


## Linear regression

#### Linear regression model with life as depdent on Income

```{r}
gap_lm <- lm(life~income,data=gap) # Linear regression model


summary(gap_lm)
```

* Linear regression equation for dependent variable Life and independent variable Income

As per linear regression model y = ?? + ?? x
Life = 38.73 + 0.0009217 * Income

##### Interpretation of Linear regression model

*	?? (a in sample prediction equation) represents the y-intercept in a linear regression model 
*	?? (b in sample prediction equation) represents the slope in a linear regression model
* As per above prediction equation we can predict every unit of increase in income will reflect 0.0009217 increase in life
* As ??>0 Both Life and Income are positively related
* Test statistic t = 139.2 & P <2e-16 indicates ?? is not equal to 0  it means both Life and Income are not  independent
* As R squared = 0.3322 denotes variation in Life can be explained to the extent of 33.22% by variation in Income

- degrees of freedom 38941 indicates only 38943 records are considered due to missing income values of 2341 records out of 41284 observations


##### Correlation of dependent variable and independent variable

```{r}
cor.test(gap$life,gap$income,use="complete.obs")

```

* As correlation r = 0.576409 denotes both the variables Life and Income are having relatively positive relationship
* 95% confidence Interval is  ( 0.5697387, 0.5830034)



##### Verification of linear relationship between dependent and independent variable

Assumptions:
1)	There is a linear relationship
2)	Variation in residuals are same for small and large values
3)	Residuals follow normal probability distribution


##### Testing of linearity

```{r}
plot(gap$income~gap$life,pch=19,col="blue",
     main='scatter plot of income vs life',
     xlab="Life",
     ylab='Income')
abline(lm(gap$income~gap$life),col="red",lty=2,lwd=3)

```

As per above scatter plot we can identify that variables Life and Income are approximately in linear relationship, as regression line is inclined to upwards as the income increases.

##### Verification of outliers

```{r}
plot(gap_lm,which = 4)  # Cooks distance

```

All the observations as per cooks distance are less than 4/38943 = 1.027, hece there no impacting outliers in the data set


##### Verify the variability in the residuals is same for both large and small values for estimated Y

```{r}

plot(gap_lm$residuals~gap_lm$fitted.values,
     main="Residual vs Predicted values")
abline(h=0,col="red",lty=2,lwd=2)

```


As per above plot variability of residuals is not same for both large and small value  for estimated y

##### Statistical test for heteroscedasticity:

```{r}
ncvTest(gap_lm)

```


As the P value < 2.22e-16  is less than 0.05 we can conclude that linear regression model has heteroscedasticity

statistical test for heteroscedasticity is in line with the residual vs fitter plot above


##### Residuals to be normally distributed

```{r}
hist(gap_lm$residuals,
     col="grey75",
     main="Distribution of residuals",
     #ylim=c(0,0.7),
     prob= TRUE)
curve(dnorm(x,mean(gap_lm$residuals),
            sd(gap_lm$residuals)),
      add=TRUE,
      col="red",
      lwd=3)

plot(gap_lm,which = 2)

```


As per above plot we can conclude residuals are not normally distributed 


Since the linear regression model has heteroscedasticity  we can conclude linear regression model does not fit variables between Life and Income.



##### Analysis on whether high income will always have high life expectancy

As R squared is 0.3322,  Variation in Life (dependent variable) to the extent of 33% is explained by variation in income(indpendent variable)

As per above scatter plot there are many people who have lower income had high life expectency

As R squared is average (33.2%), we cannot conclude income level will completely determine the life expectancy. In other words we cannot conclude high income levels will always lead to higher life expectancy. 






#### Linear regression model with Population as dependent on Life

```{r}
gap_mod2 <- lm(population~life,data=gap) # Linear regression model


summary(gap_mod2)
```
* Linear regression equation for dependent variable population and independent variable life

As per linear regression model y = alpha + beta x

population = -6315250 + 441077 * life

* As beta >0 Both Population and Life are positively related
* Test statistic t = 23.474 & P <2e-16 indicates beta is not equal to 0  it means both Population and Life are not  independent
* As R squared = 0.01317 denotes variation in Population can be explained to the extent of 1.3% by variation in Income

##### Correlation of dependent variable and independent variable

```{r}
cor.test(gap$population,gap$life,use="complete.obs")

```


* As correlation r = 0.1147721 denotes both the variables population and life are having very mild positive relationship
* 95% confidence Interval is  ( 0.1052423, 0.1242807)

##### Testing of linearity

```{r}
plot(gap$life~gap$population,pch=19,col="blue",
     main='scatter plot of income vs life',
     xlab="Population",
     ylab='Life')
abline(lm(gap$life~gap$population),col="red",lty=2,lwd=3)

```


* As per above sactter plot Population and Life are not having linear relationship

hence linear regression model is not suitable for population and life variables

##### Verify the variability in the residuals is same for both large and small values for estimated Y

```{r}

plot(gap_mod2$residuals~gap_mod2$fitted.values,
     main="Residual vs Predicted values")
abline(h=0,col="red",lty=2,lwd=2)

ncvTest(gap_mod2)

```


* Both plot and statisical testy convey Life and population has heteroscedasticity

##### Analysis on whether high Life will always have high population

As adjusted R square is 1.2% that means variation in increase in population is explained by variation in increase in life only by 1.2%

Hence we can conclude that high life will not have high population





## Cluster Analysis:

**Performing Kmeans clustering on the gapminder dataset**

```{r}

#remove NA values from the gap data frame & reduced to numeric values in the dataframe & excluded year

gap_1 <- na.omit(gap[,c(3,4,5)]) # gap_1 new data frame without null values is created

#gap_1

```

#### Scaling

```{r}
gap_1 <- scale(gap_1)
```


#### Optimal Clusters using Elbow point method

```{r, warning=FALSE}

# function to compute total within-cluster sum of square 
wss <- function(k) {
  kmeans(gap_1, k, nstart = 15 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:15

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE, 
       xlab="Number of clusters K",
       ylab="Total within-clusters sum of squares")

```

* As per above plot Elbow point optimal number of clusters is 4

* Variance from centroids to the data points are reduced highly till 4 clusters, as no of clusters increased variance reduced with lower levels


#### Cluster Visualization
```{r}
final <- kmeans(gap_1, 4, nstart = 25)
fviz_cluster(final, data = gap_1)

```



Visualzation of 4 clusters they are tighly grouped with 4 centroids.



## Answers to the Questions

 **Which region is better in Life and Income before 1950 & after 1950?**
  
 - Before 1950 Life
    - Europe and central asia is better performer with mean and median of 39 & 37 years with standard deviation fo 9
    - South asia is poor performer with mean and meain of 29 with standard deviation of 5
    
  - After 1950 Life
    - Life has improved a lot after 1950 across all regions
    - Europe & central asia is better performer with mean and median of 71 years with lower standard deviation of 6 year
    - South Asia has improved from before 1950 and after 1950
    - Sub-Saharan africa is poor performer in life with mean and median of 54 and with standard deviation of 8 compared to other regions
  
  - Before 1950 Income
    - Europe & Central Asia is better high mean & median income with high standard deviation
    - sub saharan africa is poor peformer in income before 1950 with low mean and median income
    
  - After 1950 Income
    -  Europe & central Asia is better performer since median income is high with a standadard devation of 13K lower than 32K compared to middleeast region
    - Sub Asia is poor peformer in income with low mean and median income

 **Whether life expectancy increases based on Income?**

  - As per above linear regression modle where Life is dependent on Income, Adjusted R square is 33% it means, 33% of increase in life expectancy is explained by increase in income hence it is not very conclusive to say higher income will always lead to increase life




 **Whether life expectancy improved over the years?**

  - Life has increased to almost double when compared with periods before 1950 & after 1950
  - Median Life increased to 71 from 37 for eurpoe and central asia region
  - Median life increased from 35 to 69 for America
  - Median life increased from 31 to 65 for East Asia and Pacific
  - Median life increased from 32 to 68 for Middle east and north africa
  - median life increased from 31 to 51 for sub-sahara african region
  - Median life increased from 29 to 57 for south asia


 **Whether Income levels improved over the years?**
  
  - Income has drastically increased across all regions when compared with income levels before and after 1950
  - Europe and central asia median income increased 7 times
  - America median income increased 6.5 times
  - East asia and pacific region median income increased 3.4 times
  - Middle east and north africa median income increased by 8 times
  - South asia region median income increased by 1.6 times
  - sub sahara african region median income increased by 2.2 times
   

 **Whether population increased where life expectancy is more?**

  - As per linear regression model where population is dependent on life, adjusted R square is 1.2% explains that variation in increase in population is explained by variation in increase in life only by 1.2%

  - Hence we can conclude that high life will not have high population






**End of the report**







